{% extends 'blog/base.html' %}

{% load i18n %}

{% block title %}{% trans "–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –ú–æ–π –ë–ª–æ–≥" %}{% endblock %}

{% block header %}{% trans "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ–π –±–ª–æ–≥!" %}{% endblock %}

{% block content %}
    <!-- –ü–ê–ù–ï–õ–¨ –§–ò–õ–¨–¢–†–û–í -->
    <div class="filters-card">
        <h2 class="section-title">üîç {% trans "–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è" %}</h2>

        <form method="get" action="{% url 'index' %}" class="filter-form">
            <div class="filter-grid">
                <div class="filter-group">
                    <label>{% trans "–ü–æ–∏—Å–∫ –ø–æ—Å—Ç–æ–≤" %}</label>
                    <input type="text" name="search" value="{{ search_query }}"
                           placeholder="{% trans '–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞...' %}"
                           class="filter-input">
                </div>

                <div class="filter-group">
                    <label>{% trans "–ö–∞—Ç–µ–≥–æ—Ä–∏—è" %}</label>
                    <select name="category" class="filter-select">
                        <option value="">{% trans "–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" %}</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"i" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label>{% trans "–ü–µ—Ä–∏–æ–¥" %}</label>
                    <select name="date_filter" class="filter-select">
                        <option value="">{% trans "–í—Å–µ –≤—Ä–µ–º—è" %}</option>
                        <option value="week" {% if selected_date_filter == 'week' %}selected{% endif %}>{% trans "–ó–∞ –Ω–µ–¥–µ–ª—é" %}</option>
                        <option value="month" {% if selected_date_filter == 'month' %}selected{% endif %}>{% trans "–ó–∞ –º–µ—Å—è—Ü" %}</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>&nbsp;</label>
                    <div class="filter-buttons">
                        <button type="submit" class="btn btn-primary">{% trans "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" %}</button>
                        <a href="{% url 'index' %}" class="btn btn-secondary">{% trans "–°–±—Ä–æ—Å–∏—Ç—å" %}</a>
                    </div>
                </div>
            </div>
        </form>

        {% if search_query or selected_category or selected_date_filter %}
        <div class="filter-results">
            <strong>{% trans "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:" %}</strong> {% trans "–ù–∞–π–¥–µ–Ω–æ –ø–æ—Å—Ç–æ–≤:" %} {{ posts.count }}
            {% if search_query %} ‚Ä¢ {% trans "–ü–æ–∏—Å–∫:" %} "{{ search_query }}"{% endif %}
            {% if selected_category %} ‚Ä¢ {% trans "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:" %}
                {% for category in categories %}
                    {% if category.id == selected_category|add:0 %}
                        {{ category.name }}
                    {% endif %}
                {% endfor %}
            {% endif %}
            {% if selected_date_filter == 'week' %} ‚Ä¢ {% trans "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é" %}{% endif %}
            {% if selected_date_filter == 'month' %} ‚Ä¢ {% trans "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü" %}{% endif %}
        </div>
        {% endif %}
    </div>

    <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï -->
    <div class="welcome-card">
        <h2>üë®‚Äçüíª {% trans "Monunaliev Alisher" %}</h2>
        <p>{% trans "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –º–æ–π —É—á–µ–±–Ω—ã–π –±–ª–æ–≥, –ø–æ—Å–≤—è—â–µ–Ω–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–∞ Django, Python –∏ –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º. –ó–¥–µ—Å—å —è –¥–µ–ª—é—Å—å —Å–≤–æ–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –∑–Ω–∞–Ω–∏—è–º–∏." %}</p>
    </div>

    <!-- –ì–†–ò–î –ü–û–°–¢–û–í -->
    <div class="posts-container">
        <h2 class="section-title">
            {% if search_query or selected_category or selected_date_filter %}
                üìã {% trans "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞" %}
            {% else %}
                üìù {% trans "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å—Ç—ã" %}
            {% endif %}
        </h2>

        {% if posts %}
            <div class="posts-grid">
                {% for post in posts %}
                <article class="post-card">
                    <!-- –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï -->
                    {% if post.image %}
                    <div class="post-image-wrapper">
                        <img src="{{ post.image.url }}" alt="{{ post.title }}" class="post-image" loading="lazy">
                        <div class="image-overlay"></div>
                    </div>
                    {% else %}
                    <div class="post-image-wrapper no-image">
                        <div class="placeholder-image">
                            <span>üìÑ</span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- –ö–û–ù–¢–ï–ù–¢ –ö–ê–†–¢–û–ß–ö–ò -->
                    <div class="post-body">
                        <div class="post-header">
                            <span class="post-category">{{ post.category.name|default:"–û–±—â–µ–µ" }}</span>
                            <span class="post-date">{{ post.created_date|date:"d.m.Y" }}</span>
                        </div>

                        <h3 class="post-title">
                            <a href="{% url 'post_detail' post.id %}">{{ post.title }}</a>
                        </h3>

                        <p class="post-excerpt">
                            {{ post.content|truncatechars:150 }}
                        </p>

                        <div class="post-footer">
                            <div class="post-author">
                                <span class="author-icon">üë§</span>
                                {{ post.author.username }}
                            </div>
                            <div class="post-status">
                                {% if post.is_published %}
                                <span class="status-badge published">{% trans "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω" %}</span>
                                {% else %}
                                <span class="status-badge draft">{% trans "–ß–µ—Ä–Ω–æ–≤–∏–∫" %}</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="post-actions">
                            <a href="{% url 'post_detail' post.id %}" class="btn btn-primary btn-sm">{% trans "–ß–∏—Ç–∞—Ç—å" %} ‚Üí</a>
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-results">
                <div class="empty-icon">üì≠</div>
                <h3>{% trans "–ü–æ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã" %}</h3>
                <p>{% trans "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞" %}</p>
                <a href="{% url 'index' %}" class="btn btn-primary">{% trans "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã" %}</a>
            </div>
        {% endif %}
    </div>

    <style>
        /* –°–¢–ò–õ–ò –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ */

        /* –§–∏–ª—å—Ç—Ä—ã */
        .filters-card {
            background: white;
            padding: 1.8rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06);
            border: 1px solid #e9ecef;
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            padding-bottom: 0.7rem;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
            font-size: 1.3rem;
        }

        .filter-form {
            margin-bottom: 1.5rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.2rem;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .filter-input, .filter-select {
            padding: 0.7rem 1rem;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: white;
            width: 100%;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 0.7rem;
        }

        .filter-results {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            font-size: 0.9rem;
            color: #495057;
            margin-top: 1rem;
        }

        /* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
        .welcome-card {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 2.5rem;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .welcome-card h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .welcome-card p {
            font-size: 1rem;
            opacity: 0.95;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* –ü–æ—Å—Ç—ã */
        .posts-container {
            margin-top: 1rem;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.8rem;
            margin-top: 1.5rem;
        }

        .post-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .post-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –†–ê–ó–ú–ï–† */
        .post-image-wrapper {
            width: 100%;
            height: 200px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            overflow: hidden;
            position: relative;
            background: #f8f9fa;
        }

        .post-image-wrapper.no-image {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .post-image {
            width: 100%;
            height: 100%;
            object-fit: cover; /* –í–∞–∂–Ω–æ: –æ–±—Ä–µ–∑–∞–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ */
            transition: transform 0.5s;
        }

        .post-card:hover .post-image {
            transform: scale(1.05);
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.1) 100%);
            pointer-events: none;
        }

        .placeholder-image {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            opacity: 0.7;
        }

        /* –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .post-body {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .post-category {
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .post-date {
            color: #6c757d;
            font-size: 0.85rem;
        }

        .post-title {
            margin: 0 0 1rem 0;
            font-size: 1.2rem;
            line-height: 1.4;
            color: #2c3e50;
        }

        .post-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s;
        }

        .post-title a:hover {
            color: #3498db;
        }

        .post-excerpt {
            color: #555;
            line-height: 1.5;
            margin-bottom: 1.5rem;
            flex-grow: 1;
            font-size: 0.95rem;
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            font-size: 0.85rem;
        }

        .post-author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #6c757d;
        }

        .author-icon {
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 0.3rem 0.7rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .status-badge.published {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.draft {
            background: #fff3cd;
            color: #856404;
        }

        .post-actions {
            margin-top: auto;
        }

        .btn-sm {
            padding: 0.4rem 1rem;
            font-size: 0.85rem;
        }

        /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        .no-results {
            text-align: center;
            padding: 3rem 2rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.05);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .no-results h3 {
            color: #2c3e50;
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
        }

        .no-results p {
            color: #6c757d;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }

            .posts-grid {
                grid-template-columns: 1fr;
            }

            .welcome-card {
                padding: 1.5rem;
            }

            .welcome-card h2 {
                font-size: 1.5rem;
            }

            .post-image-wrapper {
                height: 180px;
            }

            .filter-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .post-footer {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.8rem;
            }

            .filters-card,
            .post-body {
                padding: 1.2rem;
            }

            .post-image-wrapper {
                height: 160px;
            }
        }
    </style>
{% endblock %}